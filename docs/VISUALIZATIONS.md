# Judgment Gate Visualizations

This document provides visual representations of key concepts in the Judgment Gate architecture.

---

## 1. Output Filter vs Execution Boundary

### Mermaid Diagram

```mermaid
graph LR
    subgraph "Traditional Guardrails (Output Filter)"
        A1[LLM] --> B1[Tool Execution]
        B1 --> C1[Output Filter]
        C1 --> D1{Safe?}
        D1 -->|No| E1[âŒ Block output]
        D1 -->|Yes| F1[âœ“ Return]
        B1 -.->|Damage already done| G1[ğŸ’¥]
    end

    subgraph "Execution Boundary (This Work)"
        A2[LLM] --> B2{Judgment Gate}
        B2 -->|STOP/HOLD| C2[âŒ Block]
        B2 -->|ALLOW| D2[Tool Execution]
        D2 --> E2[âœ“ Return]
        C2 -.->|No damage| F2[âœ“ Safe]
    end

    style B1 fill:#ff6b6b
    style B2 fill:#51cf66
    style G1 fill:#ff6b6b
    style F2 fill:#51cf66
```

### ASCII Art (Markdown-compatible)

```
Traditional Guardrails (POST-EXECUTION)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM â”‚â”€â”€â”€â–¶â”‚Tool Executionâ”‚â”€â”€â”€â–¶â”‚Output Filter â”‚â”€â”€â”€â–¶â”‚ Result â”‚
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
            ğŸ’¥ DAMAGE DONE
         (cannot be undone)


Judgment Gate (PRE-EXECUTION)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM â”‚â”€â”€â”€â–¶â”‚ Judgment Gateâ”‚
â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚         â”‚
        â–¼         â–¼         â–¼
     STOP      HOLD      ALLOW
     âŒ         â¸ï¸         âœ…
   Block    Approval   Execute
                        â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚Tool Executionâ”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                  âœ“ Safe result
```

**Key Insight**: Damage prevention vs. damage response.

---

## 2. Accuracy vs EDC Optimization Target

### Mermaid Diagram

```mermaid
graph TD
    subgraph "Traditional Metric: Accuracy"
        A1[Correct outputs / Total outputs]
        A1 --> B1[âŒ Ignores execution cost]
        A1 --> C1[âŒ Treats all errors equally]
        A1 --> D1[âŒ Post-hoc measurement]
    end

    subgraph "EDC Metric: Expected Damage Cost"
        A2[P over-execution Ã— Cost over-execution]
        A2 --> B2[âœ“ Captures catastrophic risk]
        A2 --> C2[âœ“ Weights by damage severity]
        A2 --> D2[âœ“ Preventable before execution]
    end

    E[Example: rm -rf command]
    E --> F1[Accuracy: 1 error among 1000 = 99.9% âœ“]
    E --> F2[EDC: P Ã— âˆ = âˆ âŒ]

    style A1 fill:#ff6b6b
    style A2 fill:#51cf66
    style F1 fill:#ff6b6b
    style F2 fill:#ffa94d
```

### ASCII Chart

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Accuracy vs EDC: Why the Wrong Metric Kills                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ACCURACY OPTIMIZATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Scenario: 999 safe operations, 1 destructive (rm -rf)

  Accuracy = 999/1000 = 99.9% âœ… "Good model!"

  But... System is destroyed. ğŸ’¥


EDC OPTIMIZATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  EDC = P(over-execution) Ã— Cost(over-execution)
      = (1/1000) Ã— âˆ
      = âˆ âŒ "Unacceptable!"

  Judgment Gate: Block destructive action BEFORE execution

  EDC â†’ 0 âœ… System safe.


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ The Math                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Accuracy â‰ˆ 1 âˆ’ (# errors / # total)                       â”‚
â”‚    â†’ Treats all errors equally                             â”‚
â”‚    â†’ Post-execution measurement                            â”‚
â”‚    â†’ Wrong target for catastrophic risk                    â”‚
â”‚                                                             â”‚
â”‚  EDC = P(over-exec) Ã— Cost(over-exec)                      â”‚
â”‚    â†’ Cost(over-exec) â†’ âˆ for destructive actions           â”‚
â”‚    â†’ Therefore: must minimize P(over-exec) â†’ 0             â”‚
â”‚    â†’ Pre-execution boundaries are required by design       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Execution Timeline (Sequence Proof)

### Mermaid Sequence Diagram

```mermaid
sequenceDiagram
    participant User
    participant LLM
    participant JudgmentGate as Judgment Gate
    participant Tool as Tool Execution
    participant AuditLog as Audit Log

    User->>LLM: Request (e.g., "clean up /tmp")
    LLM->>JudgmentGate: Tool call: exec("rm -rf /tmp/test")

    rect rgb(255, 200, 200)
        Note over JudgmentGate: âš ï¸ JUDGMENT BOUNDARY
        JudgmentGate->>JudgmentGate: Load policy.yaml
        JudgmentGate->>JudgmentGate: Match regex: "rm -rf"
        JudgmentGate->>JudgmentGate: Decision: STOP
        JudgmentGate->>AuditLog: Log blocked execution
    end

    JudgmentGate--xTool: âŒ Execution prevented
    JudgmentGate->>LLM: Block (reason: destructive pattern)
    LLM->>User: Action blocked for safety

    Note over Tool: ğŸ’¥ Catastrophic action NEVER executed
```

### ASCII Sequence Diagram

```
User    LLM    Judgment Gate    Tool        Audit
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚ Request          â”‚            â”‚           â”‚
  â”‚â”€â”€â”€â”€â”€â–¶â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚  Tool call: exec("rm -rf ...")    â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚            â”‚           â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚           â”‚
  â”‚      â”‚      â”‚ JUDGMENT LAYER â”‚â”‚           â”‚
  â”‚      â”‚      â”‚                â”‚â”‚           â”‚
  â”‚      â”‚      â”‚ 1. Load policy â”‚â”‚           â”‚
  â”‚      â”‚      â”‚ 2. Match regex â”‚â”‚           â”‚
  â”‚      â”‚      â”‚ 3. Decision:   â”‚â”‚           â”‚
  â”‚      â”‚      â”‚    STOP âŒ     â”‚â”‚           â”‚
  â”‚      â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚           â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚           â”‚â”€â”€â”€â”€â”€Logâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚â—€â”€â”€Blockâ”€â”€â”€â”‚            â”‚           â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚      â”‚           â”‚     â•³â•³â•³â•³â•³â•³â•³â”‚           â”‚
  â”‚      â”‚           â”‚    EXECUTIONâ”‚           â”‚
  â”‚      â”‚           â”‚    PREVENTEDâ”‚           â”‚
  â”‚      â”‚           â”‚     â•³â•³â•³â•³â•³â•³â•³â”‚           â”‚
  â”‚      â”‚           â”‚            â”‚           â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”˜ Action blocked         â”‚           â”‚
  â”‚                                â”‚           â”‚
  â”‚                           ğŸ’¥ Catastrophic â”‚
  â”‚                           action NEVER    â”‚
  â”‚                           reached         â”‚
  â”‚                                           â”‚
```

**Proof**: Tool execution layer is never invoked for dangerous actions.

---

## 4. Decision Flow (Policy Matching)

### ASCII Decision Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tool Call Arrives                                            â”‚
â”‚  â†“                                                            â”‚
â”‚  before_tool_call(event)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Normalize    â”‚  Extract: tool, args, risk_hints
    â”‚  Context      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Load Policy  â”‚  rules/policy.yaml
    â”‚  (YAML)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Match Rules  â”‚  For each rule:
    â”‚               â”‚  â€¢ tool_in?
    â”‚               â”‚  â€¢ regex match?
    â”‚               â”‚  â€¢ risk_hints?
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚             â”‚
        â–¼                â–¼             â–¼
     MATCH            MATCH         NO MATCH
     Rule: STOP       Rule: HOLD    (all rules)
        â”‚                â”‚             â”‚
        â”‚                â”‚             â–¼
        â”‚                â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚      â”‚ Fail-Closed  â”‚
        â”‚                â”‚      â”‚ Default:HOLD â”‚
        â”‚                â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚             â”‚
        â–¼                â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Decision: STOP / HOLD / ALLOW      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚          â”‚
        â–¼         â–¼          â–¼
     STOP      HOLD       ALLOW
       â”‚         â”‚          â”‚
       â”‚         â”‚          â”‚
       â–¼         â–¼          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚ Audit Log    â”‚        â”‚
    â”‚ Write JSONL  â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
       â”‚         â”‚          â”‚
       â”‚         â”‚          â”‚
       â–¼         â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return to Runtime           â”‚
    â”‚  â€¢ STOP/HOLD â†’ {block: true} â”‚
    â”‚  â€¢ ALLOW â†’ undefined         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚          â”‚
            â”‚          â”‚
            â–¼          â–¼
        âŒ Block   âœ… Execute
```

---

## 5. Comparison Matrix (Extended)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Execution Control Approaches: Detailed Comparison                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Approach       â”‚ Judgment   â”‚ Timing       â”‚ Rollback  â”‚ Audit      â”‚
â”‚                â”‚ Point      â”‚              â”‚ Needed?   â”‚ Trail      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Guardrails AI  â”‚ Post-      â”‚ After output â”‚ N/A       â”‚ Partial    â”‚
â”‚                â”‚ output     â”‚ generation   â”‚ (output)  â”‚            â”‚
â”‚                â”‚            â”‚              â”‚           â”‚            â”‚
â”‚ LangChain      â”‚ Post-      â”‚ After tool   â”‚ YES       â”‚ Yes        â”‚
â”‚ Callbacks      â”‚ execution  â”‚ execution    â”‚ (too late)â”‚            â”‚
â”‚                â”‚            â”‚              â”‚           â”‚            â”‚
â”‚ NeMo           â”‚ Pre/post-  â”‚ Around       â”‚ N/A       â”‚ Yes        â”‚
â”‚ Guardrails     â”‚ output     â”‚ output       â”‚ (output)  â”‚            â”‚
â”‚                â”‚            â”‚              â”‚           â”‚            â”‚
â”‚ Constitutional â”‚ Training-  â”‚ Offline      â”‚ N/A       â”‚ No         â”‚
â”‚ AI             â”‚ time       â”‚ (pre-deploy) â”‚           â”‚            â”‚
â”‚                â”‚            â”‚              â”‚           â”‚            â”‚
â”‚ This Work      â”‚ PRE-       â”‚ BEFORE tool  â”‚ NO        â”‚ Complete   â”‚
â”‚ (Judgment Gate)â”‚ EXECUTION  â”‚ execution    â”‚ (prevent) â”‚ (JSONL)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Key Properties Comparison                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Approach       â”‚ Can prevent  â”‚ P(over-exec)â”‚ Core modifications     â”‚
â”‚                â”‚ catastrophic â”‚ â†’ 0?        â”‚ required?              â”‚
â”‚                â”‚ execution?   â”‚             â”‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Guardrails AI  â”‚ NO           â”‚ NO          â”‚ No (but only outputs)  â”‚
â”‚                â”‚ (output only)â”‚             â”‚                        â”‚
â”‚                â”‚              â”‚             â”‚                        â”‚
â”‚ LangChain      â”‚ NO           â”‚ NO          â”‚ Depends (middleware)   â”‚
â”‚ Callbacks      â”‚ (too late)   â”‚             â”‚                        â”‚
â”‚                â”‚              â”‚             â”‚                        â”‚
â”‚ NeMo           â”‚ NO           â”‚ NO          â”‚ Yes (Rails framework)  â”‚
â”‚ Guardrails     â”‚ (output only)â”‚             â”‚                        â”‚
â”‚                â”‚              â”‚             â”‚                        â”‚
â”‚ Constitutional â”‚ PARTIAL      â”‚ NO          â”‚ Yes (training required)â”‚
â”‚ AI             â”‚ (model-dep.) â”‚             â”‚                        â”‚
â”‚                â”‚              â”‚             â”‚                        â”‚
â”‚ This Work      â”‚ YES          â”‚ YES         â”‚ NO (plugin-based)      â”‚
â”‚ (Judgment Gate)â”‚              â”‚ (proven)    â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Risk Scenario Heatmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Risk Scenario: "rm -rf" command                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Traditional Approach (Output Filter)                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                      â”‚
â”‚                                                                â”‚
â”‚  Timeline:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ LLM â”‚ Execute â”‚Filter â”‚ Realize  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚     âœ“      ğŸ’¥       ğŸ”       ğŸ˜±                               â”‚
â”‚          DAMAGE    TOO LATE  (rollback impossible)            â”‚
â”‚          COST: âˆ                                              â”‚
â”‚                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                â”‚
â”‚  Judgment Gate (Pre-Execution Boundary)                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚
â”‚                                                                â”‚
â”‚  Timeline:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚ LLM â”‚ Judgment â”‚ BLOCKED â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚     âœ“      ğŸ›‘         âœ“                                       â”‚
â”‚          STOP      NO DAMAGE                                  â”‚
â”‚          COST: 0                                              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
  âœ“  = Step completed successfully
  ğŸ’¥ = Catastrophic damage occurred
  ğŸ” = Detection (too late)
  ğŸ›‘ = Judgment boundary (prevention)
  ğŸ˜± = Incident response (damage already done)
```

---

## 7. Integration Architecture (Plugin-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenClaw Runtime (Unmodified)                                 â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Core Agent Loop                                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  1. User request                                         â”‚ â”‚
â”‚  â”‚  2. LLM generates tool call                              â”‚ â”‚
â”‚  â”‚  3. âš¡ HOOK: before_tool_call âš¡                         â”‚ â”‚
â”‚  â”‚     â”‚                                                    â”‚ â”‚
â”‚  â”‚     â””â”€â”€â–¶ Plugin system fires registered hooks           â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  4. Execute tool (if not blocked)                        â”‚ â”‚
â”‚  â”‚  5. Return result                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ before_tool_call event
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Judgment Gate Plugin (External Package)                        â”‚
â”‚  file:../openclaw-judgment-gate                                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  plugin.ts                                                â”‚ â”‚
â”‚  â”‚  â€¢ Register hook                                          â”‚ â”‚
â”‚  â”‚  â€¢ Normalize event â†’ context                             â”‚ â”‚
â”‚  â”‚  â€¢ Call judge()                                           â”‚ â”‚
â”‚  â”‚  â€¢ Return {block: true} or undefined                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  judge.ts                                                 â”‚ â”‚
â”‚  â”‚  â€¢ Load rules (via rules.ts)                             â”‚ â”‚
â”‚  â”‚  â€¢ Match context against rules                           â”‚ â”‚
â”‚  â”‚  â€¢ Return decision: STOP/HOLD/ALLOW                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  rules.ts                                                 â”‚ â”‚
â”‚  â”‚  â€¢ Load rules/policy.yaml                                â”‚ â”‚
â”‚  â”‚  â€¢ Parse YAML â†’ matcher functions                        â”‚ â”‚
â”‚  â”‚  â€¢ Return array of rules                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  logger.ts                                                â”‚ â”‚
â”‚  â”‚  â€¢ Write audit entry to JSONL                            â”‚ â”‚
â”‚  â”‚  â€¢ Include: ts, tool, decision, reason, context          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  rules/policy.yaml                                        â”‚ â”‚
â”‚  â”‚  â€¢ Declarative rules (STOP/HOLD/ALLOW)                   â”‚ â”‚
â”‚  â”‚  â€¢ Versioned, auditable                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Properties:
  âœ“ Zero core modifications (OpenClaw unmodified)
  âœ“ 100% plugin-based (external package)
  âœ“ Native hook (before_tool_call is OpenClaw's own API)
  âœ“ Composable (other plugins can coexist)
```

---

## 8. EDC Formula Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Expected Damage Cost (EDC) Formula                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  EDC = P(over-execution) Ã— Cost(over-execution)


  Where:
  â”€â”€â”€â”€â”€â”€

  P(over-execution) = Probability that a dangerous action
                       is executed when it should not be

  Cost(over-execution) = Damage caused by one over-execution
                          (often unbounded: data loss,
                          financial loss, system compromise)


  For autonomous agents:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Cost(over-execution) â†’ âˆ  (for catastrophic actions)

  Therefore:

  EDC â†’ 0  âŸº  P(over-execution) â†’ 0


  Proof (Empirical):
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Scenarios tested: 4 dangerous actions
  Blocked: 4
  Over-executed: 0

  P(over-execution) = 0/4 = 0  âœ…

  EDC = 0 Ã— âˆ = 0  âœ…


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Why This Matters                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Traditional ML: Optimize for accuracy, precision, recall      â”‚
â”‚                                                                â”‚
â”‚  Problem: These metrics don't account for catastrophic risk   â”‚
â”‚                                                                â”‚
â”‚  99.9% accuracy = 1 destructive error per 1000 actions        â”‚
â”‚    â†’ If that 1 error is "rm -rf /", system is destroyed       â”‚
â”‚    â†’ All other 999 correct actions are meaningless            â”‚
â”‚                                                                â”‚
â”‚  EDC optimization: Minimize P(over-execution) to ZERO          â”‚
â”‚    â†’ Even 0.1% over-execution rate is unacceptable            â”‚
â”‚    â†’ Must prevent dangerous actions BEFORE execution          â”‚
â”‚    â†’ This requires judgment boundary PRE-execution            â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Usage Notes

All diagrams above are:

1. **Mermaid-compatible** - Render on GitHub, GitLab, and most markdown viewers
2. **ASCII art fallbacks** - Work in plain text environments
3. **Conceptually focused** - Emphasize the "why" not just the "how"
4. **EDC-centered** - Frame around Expected Damage Cost, not accuracy

To embed in presentations, documentation, or papers:
- Use Mermaid diagrams for web/interactive formats
- Use ASCII art for printed materials or terminals
- Cite this repository as the source
